# Whisperモデルのベンチマーク結果

## 概要

このドキュメントでは、VideoTranscriptionシステムで使用されるWhisperモデルの各種設定におけるベンチマークテスト結果をまとめています。これらの結果は、Apple Silicon（M1/M2/M3）搭載のMacでの測定値です。

## テスト環境

- **ハードウェア**: MacBook Pro (M1 Pro, 16GB RAM)
- **OS**: macOS Sonoma 14.3
- **Python**: 3.9.6
- **PyTorch**: 2.1.0
- **テストファイル**: 約54秒の音声ファイル (Sample_audio.wav)

## モデルサイズとデバイスの比較

### baseモデル

| デバイス | 処理時間 | セグメント数 | 相対速度 |
|---------|---------|------------|---------|
| CPU     | 約17秒   | 8          | 2.0x    |
| MPS     | 約34秒   | 8          | 1.0x    |

### mediumモデル

| デバイス | 処理時間 | セグメント数 | 相対速度 |
|---------|---------|------------|---------|
| CPU     | 約300秒  | 12         | 0.48x   |
| MPS     | 約143秒  | 12         | 1.0x    |

## 詳細な処理時間分析

### baseモデル (CPU)

```
チャンク1 (0.00秒 - 30.00秒): 処理時間 = 8.56秒
チャンク2 (28.00秒 - 53.74秒): 処理時間 = 8.12秒
合計処理時間: 約17秒
```

### baseモデル (MPS)

```
チャンク1 (0.00秒 - 30.00秒): 処理時間 = 17.32秒
チャンク2 (28.00秒 - 53.74秒): 処理時間 = 16.89秒
合計処理時間: 約34秒
```

### mediumモデル (MPS)

```
チャンク1 (0.00秒 - 30.00秒): 処理時間 = 71.45秒
チャンク2 (28.00秒 - 53.74秒): 処理時間 = 70.98秒
合計処理時間: 約143秒
```

## 精度比較

### baseモデル vs mediumモデル

- **baseモデル**: 8セグメント認識
- **mediumモデル**: 12セグメント認識（マージ前は13セグメント）

mediumモデルはbaseモデルと比較して、より細かいセグメントに分割し、より多くのテキストを認識する傾向があります。これは、モデルの精度が高いため、短い発話や小さな音声の変化も検出できるためです。

## 結論と推奨設定

### 高速処理優先の場合

小さいモデル（tiny, base）を使用する場合は、**CPU**の方が高速です。

```yaml
models:
  whisper:
    model:
      name: "base"
    device: "cpu"
```

### 精度優先の場合

大きいモデル（small, medium, large）を使用する場合は、**MPS**（Apple Silicon GPU）の方が高速です。

```yaml
models:
  whisper:
    model:
      name: "medium"
    device: "mps"
```

## 考察

1. **小さいモデルでのCPU優位性**:
   - 小さいモデル（tiny, base）では、GPUへのデータ転送オーバーヘッドがモデル計算時間を上回るため、CPUの方が高速になります。
   - これらのモデルは比較的単純なため、CPUでも効率的に処理できます。

2. **大きいモデルでのGPU優位性**:
   - 大きいモデル（small, medium, large）では、計算量が増加するため、GPUの並列処理能力が活きてきます。
   - データ転送のオーバーヘッドを考慮しても、GPUの方が高速になります。

3. **精度とパフォーマンスのトレードオフ**:
   - baseモデルは処理速度が速い一方、認識精度はmediumモデルより低くなります。
   - 用途に応じて、速度と精度のバランスを考慮したモデル選択が重要です。

## 今後の最適化の方向性

1. **モデル量子化の検討**:
   - INT8量子化などを適用することで、大きいモデルでもメモリ使用量と処理時間を削減できる可能性があります。

2. **バッチ処理の最適化**:
   - 複数の音声ファイルを同時に処理する場合、バッチサイズの最適化によりスループットを向上できる可能性があります。

3. **音声前処理の改善**:
   - ノイズ除去や無音区間の削除など、音声の前処理を改善することで、認識精度と処理速度の両方を向上できる可能性があります。 