# モジュール仕様書

## 1. VideoProcessor クラス
メインの処理を統括するクラス。各モジュールの連携と処理フローを管理します。

### 1.1 主要メソッド
- `process_video(video_path, output_dir)`: 動画処理のメインメソッド
- `extract_frames(video_path)`: フレーム抽出処理
- `extract_audio(video_path)`: 音声抽出処理
- `transcribe_audio(audio_path)`: 音声認識処理
- `process_screenshots(screenshots)`: スクリーンショット処理
- `analyze_content(transcription, screenshots)`: コンテンツ分析処理

### 1.2 設定パラメータ
- フレーム抽出設定
  - base_frames_per_hour: 1時間あたりの基本フレーム数
  - min_frames: 最小フレーム数
  - important_frame_ratio: 重要フレームの比率
  - min_important_frames: 最小重要フレーム数

- OCR設定
  - languages: 対応言語
  - min_quality: テキスト品質基準
  - page_seg_mode: ページセグメンテーションモード

- 音声認識設定
  - language: 認識言語
  - temperature: 生成温度
  - beam_size: ビームサイズ

## 2. フレーム抽出モジュール

### 2.1 機能要件
- 動画からの定期的なフレーム抽出
- シーン変化の検出
- 重要フレームの選定
- 画像品質の最適化

### 2.2 処理アルゴリズム
1. 動画の基本情報取得(長さ、FPS)
2. 抽出間隔の計算
3. フレームの定期抽出
4. シーン変化検出
   - 動き検出(モーション分析)
   - エッジ変化検出
5. 重要度スコアリング
6. フレーム選定

## 3. OCR処理モジュール

### 3.1 機能要件
- 画像からのテキスト抽出
- マルチ言語対応
- テキスト品質評価
- ノイズ除去

### 3.2 処理手順
1. 画像の前処理
   - リサイズ
   - ノイズ除去
   - コントラスト調整
2. OCR処理
3. テキストクリーニング
4. 品質評価

## 4. 音声認識モジュール

### 4.1 機能要件
- 音声ファイルからのテキスト生成
- タイムスタンプ付与
- 高精度な日本語認識
- 信頼度スコアリング

### 4.2 処理手順
1. 音声ファイル抽出
2. Whisperモデルによる認識
3. セグメント分割
4. タイムスタンプ付与
5. テキストクリーニング

## 5. テキスト処理モジュール

### 5.1 キーワード抽出
- MeCabによる形態素解析
- 重要度スコアリング
- フィルタリング条件
  - 最小文字数
  - 品詞条件
  - 出現頻度

### 5.2 トピック分析
- TF-IDF処理
- クラスタリング
- 類似度計算
- トピック選定基準

### 5.3 テキスト要約
- Google Gemini APIによる要約生成
- パラメータ設定
  - 最大トークン数
  - 生成温度
  - トップK
  - トップP
- プロンプト設計
  - コンテキスト提供
  - 要約指示
  - 制約条件
- 品質評価基準
  - 一貫性
  - 簡潔性
  - 重要情報の保持

## 6. エラーハンドリング

### 6.1 エラー種別
- 入力エラー
  - ファイル不存在
  - フォーマット不正
  - パラメータ不正
- 処理エラー
  - OCR失敗
  - 音声認識失敗
  - メモリ不足
- システムエラー
  - 外部API接続エラー
  - ディスク容量不足
  - 権限エラー

### 6.2 エラー処理方針
1. エラーの検出と分類
2. ログ記録
3. リカバリー処理
4. エラーレポート生成
5. 処理の継続判断

## 7. パフォーマンス最適化

### 7.1 最適化ポイント
- 並列処理
  - フレーム抽出
  - OCR処理
  - テキスト処理
- メモリ管理
  - バッチ処理
  - リソース解放
- キャッシュ戦略
  - 中間結果の保存
  - 再利用可能なデータの管理

### 7.2 モニタリング項目
- 処理時間
- メモリ使用量
- CPU使用率
- ディスク使用量
- エラー率